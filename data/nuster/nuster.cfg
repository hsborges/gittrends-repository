global
    nuster cache on data-size 500m dir /tmp/cache
defaults
    retries 3
    mode http
    option redispatch
    timeout client  30s
    timeout connect 30s
    timeout server  30s
frontend fe
    bind *:80
    use_backend api if { path_beg /api }
    default_backend nuxt
backend nuxt
    nuster cache on
    nuster rule eternal-b1 ttl 0
    nuster rule homepage ttl 10m if { path / }
    nuster rule basic-b1 disk on wait on etag on last-modified on
    server b1 website-server:80
backend api
    nuster cache on
    http-request set-path "%[path,regsub(^/api/,/)]"
    nuster rule eternal-b2 ttl 0
    nuster rule basic-b2 disk on wait on etag on last-modified on
    server b2 website-api:80
